---
title: Mettez √† jour TaskFormComponent
description: D√©couvrez comment mettre √† jour le `TaskFormComponent` pour l'utiliser pour la mise √† jour de la t√¢che.
---

import { Steps } from '@astrojs/starlight/components';
import Objective from '../../../../../components/learning-objective.astro';

<Objective class="drop-shadow-xl" objectives={[
{mainTitle: 'Objectifs de ce chapitre', title: 'Remplissez le formulaire avec les donn√©es existantes', description: 'D√©couvrez comment remplir un formulaire avec les donn√©es existantes de la t√¢che.'},
]} />

Vous pouvez d√©sormais acc√©der au **TaskFormComponent** en cliquant sur le lien `Mettre √† jour`.
Ce chemin inclut une valeur dynamique pour transmettre l'**id** de la t√¢che √† mettre √† jour.

Le formulaire **TaskFormComponent** est actuellement vide car il a √©t√© cr√©√© pour ajouter une nouvelle t√¢che et il est donc initialis√© comme formulaire vide.

```typescript
// task-form.component.ts
task = {
  id: '',
  title: '',
  description: ''
};
```

Mettez-le √† jour pour utiliser le formulaire √† la fois pour cr√©er et mettre √† jour une t√¢che.

## R√©cup√©rer les informations de la t√¢che √† mettre √† jour avec le TaskService

Avant de r√©cup√©rer l'identifiant de la route, pr√©parons la logique pour identifier la t√¢che √† mettre √† jour.
Comme la liste des t√¢ches est stock√©e dans **TaskService**, vous allez ajouter une nouvelle fonction pour r√©cup√©rer une t√¢che en fonction de son **id**.
A partir de cet identifiant, vous r√©cup√©rerez la t√¢che pour remplir le formulaire.

### üéì Instructions

<Steps>

1. Mettez √† jour le fichier `src/app/task-service.ts`.

   ```typescript ins={"Ajoutez une fonction pour r√©cup√©rer une t√¢che par rapport √† son identifiant": 28-31}
   import { Injectable } from '@angular/core';
   import { Task } from './task.model';

   @Injectable({
     providedIn: 'root'
   })
   export class TaskService {
       tasks: Task[] = [
           {
               title: 'T√¢che 1',
               description: 'Description de la t√¢che 1',
               createdAt: new Date()
           },
           {
               title: 'T√¢che 2',
               description: 'Description de la t√¢che 2',
               createdAt: new Date()
           }
       ];

       addTask(task: Task): void {
           this.tasks.push({
               ...task,
               createdAt: new Date()
           });
       }


     getTask(id: string): Task {
       return this.tasks.find(task => task.id === id)!;
     }
   }
   ```

</Steps>

## R√©cup√©rer l'identifiant de la t√¢che de la route

L'**id** est pr√©sent dans le chemin de la route, vous devez le r√©cup√©rer dans le composant **TaskFormComponent**.
Utilisez le service **ActivatedRoute** pour r√©cup√©rer l'**id** de la route.

Ce service donne acc√®s √† des informations sur l'itin√©raire actuel.
Comme vous l'avez fait avec le **Router**, vous l'injecterez dans le constructeur du **TaskFormComponent**.

### Hooks: cycle de vie Angular

Jusqu'√† pr√©sent, vous avez initialis√© les propri√©t√©s de classe lors de leur d√©claration.

Par exemple, vous avez initialis√© la propri√©t√© **task** avec un objet vide¬†:

```typescript
task = {
  id: '',
  title: '',
  description: ''
};
```

Vous ne pouvez pas utiliser une telle logique pour initialiser la propri√©t√© **task** avec la t√¢che √† mettre √† jour car cet `id` n'est pas encore disponible lors de la cr√©ation de la classe Component.

Pourquoi ?

De sa cr√©ation √† sa destruction, un composant passe par plusieurs √©tapes.
Lors de la cr√©ation de la classe de l'√©tape Component, les informations de la route ne sont pas encore disponibles.

Pour g√©rer un tel cas, Angular fournit des hooks de cycle de vie.
Les hooks de cycle de vie sont des m√©thodes qu'Angular appelle dans les composants et directives lorsqu'il les cr√©e, les modifie et les d√©truit.

L'un des hooks de cycle de vie les plus utilis√©s est **ngOnInit**, il est d√©j√† pr√©sent dans tous les composants cr√©√©s de l'application.
Ce hook est appel√© juste apr√®s qu'Angular ait instanci√© la classe Component.
Et √† ce moment-l√†, le composant est capable de lire les informations de la route.

√Ä l‚Äôint√©rieur de ce hook, commencez par r√©cup√©rer l‚Äôidentifiant de la route.

```typescript
ngOnInit() {
    const id = this.route.snapshot.paramMap.get('id');
}
```

**route.snapshot** est une image statique des informations d'itin√©raire et expose une propri√©t√© **paramMap**.

Ce **paramMap** est une carte des param√®tres obligatoires et facultatifs sp√©cifiques √† l'itin√©raire, y compris les param√®tres de chemin de la route dynamique.
La m√©thode **get** de l'objet **paramMap** nous permet de r√©cup√©rer la valeur d'un param√®tre en fonction du nom que vous avez utilis√© dans la d√©finition du chemin de route¬†: **id**.

Ensuite, vous r√©cup√©rerez la t√¢che √† mettre √† jour √† partir du **TaskService** en fonction de l'**id** disponible dans la route.

```typescript
ngOnInit() {
      const id = this.route.snapshot.paramMap.get('id');
      this.task = this.taskService.getTask(id);
  }
```

:::tip
Le **TaskFormComponent** est utilis√© √† la fois pour cr√©er et mettre √† jour une t√¢che.
Vous devez tester si l'**id** est disponible dans la route avant de r√©cup√©rer la t√¢che √† mettre √† jour.
Cela √©vitera une erreur lorsque l'**id** n'est pas disponible dans la route.
:::

```typescript
ngOnInit() {
      const id = this.route.snapshot.paramMap.get('id');

      if (id) {
          this.task = this.taskService.getTask(id);
      }
}
```

### üéì Instructions

<Steps>

1. Mettez √† jour le fichier `src/app/task-form/task-form.component.ts`.

   ```typescript ins={"inecter ActivatedRoute": 20-21} ins={"R√©cup√©rez l'identifiant de la t√¢che √† partir de la route": 23-30}
   import { Component, OnInit } from '@angular/core';
   import { ActivatedRoute } from '@angular/router';
   import { TaskService } from '../task.service';

   @Component({
     selector: 'app-task-form',
     templateUrl: './task-form.component.html',
     styleUrls: ['./task-form.component.css']
   })
   export class TaskFormComponent implements OnInit {
     task = {
       id: '',
       title: '',
       description: ''
     };

     constructor(
         private taskService: TaskService,
         private router: Router,

         private route: ActivatedRoute) {
     }

     ngOnInit() {
         const id = this.route.snapshot.paramMap.get('id');

         if (id) {
             this.task = this.taskService.getTask(id);
         }
     }
   }
   ```

</Steps>

## Testez-le

<Steps>
1. Cliquez sur le bouton `Mettre √† jour` √† c√¥t√© d'une t√¢che dans la liste.
2. Le formulaire doit √™tre rempli avec la t√¢che √† mettre √† jour.
</Steps>

## ‚úîÔ∏è Ce que vous avez appris

Dans ce chapitre, vous avez appris √† mettre √† jour **TaskFormComponent** pour remplir le formulaire avec la t√¢che √† mettre √† jour. Vous avez appris √† r√©cup√©rer la t√¢che √† partir du **TaskService** en fonction du **id** disponible dans la route.





