---
title: R√©cup√©rez la liste des t√¢ches
description: D√©couvrez comment interroger la liste des t√¢ches √† partir du serveur API dans une application Angular.
---

import { Steps } from '@astrojs/starlight/components';
import Objective from '../../../../../components/learning-objective.astro';

<Objective class="drop-shadow-xl" objectives={[
    {mainTitle: 'Objectifs de ce chapitre', title: 'R√©cup√©rez la liste des t√¢ches', description: 'R√©cup√©rez la liste des t√¢ches du faux serveur API.'},
]} />

## Mettez √† jour TaskService

Le service **HttpClient** expose plusieurs fonctions qui vous permettent de r√©aliser des requ√™tes HTTP √† un serveur. Dans ce chapitre, vous utiliserez la m√©thode **get** pour r√©cup√©rer la liste des t√¢ches depuis le serveur API.

:::note
**get** fait r√©f√©rence aux requ√™tes **GET** dans le protocole HTTP.
:::

Cette fonction prend le chemin de la route du serveur API comme param√®tre¬†: `http://localhost:3000/tasks`.
C'est l'URL qu'il interrogera pour obtenir la liste des t√¢ches.

```typescript
getTasks(): Observable<Task[]> {
  return this.http.get<Task[]>('http://localhost:3000/tasks');
}
```

Cette nouvelle m√©thode **getTasks** d√©finit la communication avec le serveur API¬†:

- Il fait une requ√™te **GET**;
- Il attend un tableau d'objets **Task** en r√©ponse;
- Il communique avec le serveur API √† l'URL `http://localhost:3000/tasks`.

:::caution
L'API sera responsable de r√©cup√©rer la liste des t√¢ches et vous n'aurez plus besoin de la variable **tasks** du **TaskService**.
N√©anmoins, du code d√©pendant encore de cette variable, vous devrez la conserver pour le moment.
:::

### üéì Instructions

<Steps>

1. Mettez √† jour le fichier `src/app/task.service.ts`.

    ```typescript ins={"Ajoutez la fonction getTasks": 24-27}
    import { Injectable } from '@angular/core';
    import { HttpClient } from '@angular/common/http';
    import { Task } from './task.model';

    @Injectable({
        providedIn: 'root'
    })
    export class TaskService {

        tasks: Task[] = [
            {
                id: '1',
                title: 'Premi√®re t√¢che',
                description: 'Voici la premi√®re t√¢che de ta to-do liste.'
            },
            {
                id: '2',
                title: 'Seconde t√¢che',
                description: 'Voici la seconde t√¢che de ta to-do liste.'
            }
        ];

        constructor(private http: HttpClient) { }

        getTasks(): Observable<Task[]> {
            return this.http.get<Task[]>('http://localhost:3000/tasks');
        }
    }
    ```

</Steps>

## Mettez √† jour TaskListComponent

R√©alisez la mise √† jour de **TaskListComponent** pour qu'il utilise la nouvelle m√©thode **getTasks** et renommez la variable **tasks** en **tasks$**. Ajouter `$` permet de signaler qu'il s'agit d'une Observable.

```typescript
tasks$ = this.taskService.getTasks();
```

Pourquoi ? Qu'est-ce qu'une observable¬†?

**tasks** √©tait un tableau d'objets **Task**. D√©sormais, **tasks$** est une observable d'un tableau d'objets **Task**.

En appelant la fonction **getTasks**, on obtient une Observable qui √©mettra la liste des t√¢ches une fois re√ßue du serveur API.
Pour diff√©rencier une valeur de l'observable, la communaut√© Angular utilise couramment le suffixe `$` dans les applications Angular.

:::note
Une Observable **observe** un flux de donn√©es.
:::

### üéì Instructions

<Steps>

1. Mettez √† jour le fichier `src/app/task-list/task-list.component.ts`.

    ```typescript del={"Supprimez la variable task": 11-12} ins={"Remplacez-la avec la variable tasks$": 13-14}
    import { Component } from '@angular/core';
    import { TaskService } from '../task.service';
    import { Task } from '../task.model';

    @Component({
        selector: 'app-task-list',
        templateUrl: './task-list.component.html',
        styleUrls: ['./task-list.component.css']
    })
    export class TaskListComponent {

        tasks: Task[] = this.taskService.tasks;

        tasks$ = this.taskService.getTasks();

        constructor(private taskService: TaskService) { }
    }
    ```

</Steps>

## Abonnement

L'appel de la fonction **getTasks** ne d√©clenchera pas la requ√™te API imm√©diatement. Comme elle ne se d√©clenche pas encore, l'observable n'√©mettra aucune valeur.
D√©clenchez ce que nous appelons un abonnement √† l'observable pour lancer la requ√™te.

:::tip
Vous vous **abonnez** √† une observable comme vous vous abonneriez √† un journal.
Vous demandez le dernier num√©ro du journal. Seulement une fois qu'il est disponible, il vous est livr√© et vous pouvez le lire.
:::

### Comment s'abonner ?

Il existe plusieurs fa√ßons de s'abonner √† une observable.
Pour la situation donn√©e, utilisez le pipe **async** dans le Template HTML.

Comme le pipe **date** utilis√© pr√©c√©demment, le r√¥le du pipe **async** est de transformer les donn√©es avant de les afficher.
Ici son r√¥le sera de s'abonner √† l'observable et de renvoyer la liste des t√¢ches une fois disponible.

:::tip
Bien qu'il existe des alternatives, le pipe **async** est le moyen recommand√© pour s'abonner √† une observable dans le Template HTML.
Vous d√©couvrirez l'alternative √† la fin de cette page.
:::

### üéì Instructions

<Steps>

1. Modifiez le fichier `src/app/task-list/task-list.component.html`.

    ```html ins="tasks$ | async"
    <tr *ngFor="let task of tasks$ | async">
    <td>{{ task.title }}</td>
    <td>{{ task.createdAt | date }}</td>
    <td>
        <a class="btn btn-primary" [routerLink]="['/update', task.id]">Mettre √† jour</a>
    <button class="btn btn-danger" type="button" (click)="deleteTask(task.id)">Supprimer</button>
        </td>
    </tr>
    ```

</Steps>

### Alternative

L'alternative √† l'utilisation du pipe **async** consiste √† s'abonner √† l'observable dans le composant.

Cela se fait en appelant la fonction **subscribe** sur l'observable et en passant une fonction comme param√®tre de rappel.
Ce rappel sera fait une fois que les donn√©es seront disponibles.

Cet abonnement sera utilis√© dans la fonction **ngOnInit** de la classe **TaskListComponent**.

### üéì Instructions

<Steps>

1. Modifiez le fichier `src/app/task-list/task-list.component.ts`.

    ```typescript ins={"Subscribe to the observable": 14-17}
    import { Component, OnInit } from '@angular/core';
    import { TaskService } from '../task.service';
    import { Task } from '../task.model';

    @Component({
        selector: 'app-task-list',
        templateUrl: './task-list.component.html',
        styleUrls: ['./task-list.component.css']
    })
    export class TaskListComponent implements OnInit {
        tasks: Task[] = this.taskService.tasks;

        constructor(private taskService: TaskService) { }

        ngOnInit() {
            this.taskService.getTasks().subscribe(tasks => this.tasks = tasks);
        }
    }
    ```

</Steps>

### Pi√®ges

Bien que l'abonnement √† l'observable dans le composant soit une solution valable, il manque certaines optimisations fournies par le pipe **async**.
Cela n√©cessite √©galement plus de code pour le m√™me r√©sultat.

Effectivement, dans le cas o√π vous utilisez la souscription √† l'observable dans le composant, vous devez penser √† vous **d√©sabonner**.
Nous ne verrons pas cette action pour le moment. Vous pouvez √©changer avec votre mentor pour plus de d√©tails.

## ‚úîÔ∏è Ce que vous avez appris

Dans ce chapitre, vous avez appris l'une des fonctionnalit√©s cl√©s d'Angular : comment interroger les donn√©es d'un serveur API !
